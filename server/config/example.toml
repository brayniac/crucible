# Crucible Server Example Configuration
#
# This is a general-purpose configuration suitable for most workloads.
# For specific use cases, see:
#   - redis.toml    - Redis-compatible configuration
#   - memcached.toml - Memcached-compatible configuration
#   - heap.toml     - Heap backend (no segment fragmentation)
#   - slab.toml     - Slab allocator with per-object LRU

# Runtime selection: "native" (io_uring/mio) or "tokio"
runtime = "native"

# Shutdown configuration
[shutdown]
# Timeout in seconds for draining connections during graceful shutdown
drain_timeout_secs = 30

# Logging configuration
[logging]
# Log level: "error", "warn", "info", "debug", "trace"
# Can be overridden with RUST_LOG environment variable
level = "info"
# Log format: "pretty" (human-readable), "json", or "compact"
format = "pretty"
# Include timestamps
timestamps = true
# Include thread names (useful for debugging multi-threaded issues)
thread_names = false
# Include module target in log output
target = true

[workers]
# Number of worker threads (default: number of CPUs)
threads = 4

# CPU cores to pin workers to (optional)
# cpu_affinity = "0-3"

[cache]
# Cache backend (storage type): "segment", "slab", or "heap"
backend = "segment"

# Eviction policy (depends on backend):
#   segment: "s3fifo" (default), "fifo", "random", "cte", "merge"
#   heap:    "s3fifo" (default), "lfu"
#   slab:    "lra" (default), "lrc", "random", "none"
policy = "s3fifo"

# Total heap size
heap_size = "1GB"

# Segment size (not used by heap backend)
segment_size = "8MB"

# Maximum value size (must be less than segment_size)
max_value_size = "1MB"

# Hashtable power (2^power buckets)
# Size the hashtable for your expected item count:
#   2^16 = 65K buckets, good for ~30K items
#   2^20 = 1M buckets, good for ~500K items
#   2^24 = 16M buckets, good for ~8M items
hashtable_power = 16

# Disk tier - extend cache capacity beyond RAM (optional)
# When enabled, evicted items are demoted to disk instead of discarded.
# Uncomment to enable:
# [cache.disk]
# enabled = true
# path = "/var/cache/crucible/disk.dat"
# size = "100GB"
# promotion_threshold = 2    # Promote items accessed > N times to RAM
# sync_mode = "async"        # "sync", "async", or "none"
# recover_on_startup = true  # Recover disk cache on restart

# RESP protocol listener (Redis-compatible)
[[listener]]
protocol = "resp"
address = "127.0.0.1:6379"

# Memcache protocol listener
[[listener]]
protocol = "memcache"
address = "127.0.0.1:11211"

[metrics]
# Prometheus metrics endpoint
address = "127.0.0.1:9090"

# io_uring specific settings (native runtime on Linux only)
[uring]
sqpoll = false
sqpoll_idle_ms = 1000
buffer_count = 2048
buffer_size = "16KB"
sq_depth = 1024
